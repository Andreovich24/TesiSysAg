import torch
import torch.nn as nn
import attention_vggface2.resnet50.vggface2 as model
import attention_vggface2.bot.bot as bot_module
import attention_vggface2.bot.bottlestack as bot_block
from collections import OrderedDict


class VGGFace2Bot(nn.Module):

    def __init__(self, classes=7):
        super().__init__()
        self.vggface2 = model.VGGFace2(pretrained=True, classes=classes)

        mhsa_c5_1 = bot_module.MHSA(512, width = 7, height = 7, heads = 4)
        mhsa_c5_2 = bot_module.MHSA(512, width = 7, height = 7, heads = 4)
        mhsa_c5_3 = bot_module.MHSA(512, width = 7, height = 7, heads = 4)

        self.vggface2.vggface2.conv5_1_3x3 = mhsa_c5_1
        self.vggface2.vggface2.conv5_2_3x3 = mhsa_c5_2
        self.vggface2.vggface2.conv5_3_3x3 = mhsa_c5_3

    def forward(self, data):
        conv1_7x7_s2 = self.vggface2.vggface2.conv1_7x7_s2(data)
        conv1_7x7_s2_bn = self.vggface2.vggface2.conv1_7x7_s2_bn(conv1_7x7_s2)
        conv1_7x7_s2_bnxx = self.vggface2.vggface2.conv1_relu_7x7_s2(conv1_7x7_s2_bn)
        pool1_3x3_s2 = self.vggface2.vggface2.pool1_3x3_s2(conv1_7x7_s2_bnxx)
        conv2_1_1x1_reduce = self.vggface2.vggface2.conv2_1_1x1_reduce(pool1_3x3_s2)
        conv2_1_1x1_reduce_bn = self.vggface2.vggface2.conv2_1_1x1_reduce_bn(conv2_1_1x1_reduce)
        conv2_1_1x1_reduce_bnxx = self.vggface2.vggface2.conv2_1_1x1_reduce_relu(conv2_1_1x1_reduce_bn)
        conv2_1_3x3 = self.vggface2.vggface2.conv2_1_3x3(conv2_1_1x1_reduce_bnxx)
        conv2_1_3x3_bn = self.vggface2.vggface2.conv2_1_3x3_bn(conv2_1_3x3)
        conv2_1_3x3_bnxx = self.vggface2.vggface2.conv2_1_3x3_relu(conv2_1_3x3_bn)
        conv2_1_1x1_increase = self.vggface2.vggface2.conv2_1_1x1_increase(conv2_1_3x3_bnxx)
        conv2_1_1x1_increase_bn = self.vggface2.vggface2.conv2_1_1x1_increase_bn(conv2_1_1x1_increase)
        conv2_1_1x1_proj = self.vggface2.vggface2.conv2_1_1x1_proj(pool1_3x3_s2)
        conv2_1_1x1_proj_bn = self.vggface2.vggface2.conv2_1_1x1_proj_bn(conv2_1_1x1_proj)
        conv2_1 = torch.add(conv2_1_1x1_proj_bn, 1, conv2_1_1x1_increase_bn)
        conv2_1x = self.vggface2.vggface2.conv2_1_relu(conv2_1)
        conv2_2_1x1_reduce = self.vggface2.vggface2.conv2_2_1x1_reduce(conv2_1x)
        conv2_2_1x1_reduce_bn = self.vggface2.vggface2.conv2_2_1x1_reduce_bn(conv2_2_1x1_reduce)
        conv2_2_1x1_reduce_bnxx = self.vggface2.vggface2.conv2_2_1x1_reduce_relu(conv2_2_1x1_reduce_bn)
        conv2_2_3x3 = self.vggface2.vggface2.conv2_2_3x3(conv2_2_1x1_reduce_bnxx)
        conv2_2_3x3_bn = self.vggface2.vggface2.conv2_2_3x3_bn(conv2_2_3x3)
        conv2_2_3x3_bnxx = self.vggface2.vggface2.conv2_2_3x3_relu(conv2_2_3x3_bn)
        conv2_2_1x1_increase = self.vggface2.vggface2.conv2_2_1x1_increase(conv2_2_3x3_bnxx)
        conv2_2_1x1_increase_bn = self.vggface2.vggface2.conv2_2_1x1_increase_bn(conv2_2_1x1_increase)
        conv2_2 = torch.add(conv2_1x, 1, conv2_2_1x1_increase_bn)
        conv2_2x = self.vggface2.vggface2.conv2_2_relu(conv2_2)
        conv2_3_1x1_reduce = self.vggface2.vggface2.conv2_3_1x1_reduce(conv2_2x)
        conv2_3_1x1_reduce_bn = self.vggface2.vggface2.conv2_3_1x1_reduce_bn(conv2_3_1x1_reduce)
        conv2_3_1x1_reduce_bnxx = self.vggface2.vggface2.conv2_3_1x1_reduce_relu(conv2_3_1x1_reduce_bn)
        conv2_3_3x3 = self.vggface2.vggface2.conv2_3_3x3(conv2_3_1x1_reduce_bnxx)
        conv2_3_3x3_bn = self.vggface2.vggface2.conv2_3_3x3_bn(conv2_3_3x3)
        conv2_3_3x3_bnxx = self.vggface2.vggface2.conv2_3_3x3_relu(conv2_3_3x3_bn)
        conv2_3_1x1_increase = self.vggface2.vggface2.conv2_3_1x1_increase(conv2_3_3x3_bnxx)
        conv2_3_1x1_increase_bn = self.vggface2.vggface2.conv2_3_1x1_increase_bn(conv2_3_1x1_increase)
        conv2_3 = torch.add(conv2_2x, 1, conv2_3_1x1_increase_bn)
        conv2_3x = self.vggface2.vggface2.conv2_3_relu(conv2_3)
        conv3_1_1x1_reduce = self.vggface2.vggface2.conv3_1_1x1_reduce(conv2_3x)
        conv3_1_1x1_reduce_bn = self.vggface2.vggface2.conv3_1_1x1_reduce_bn(conv3_1_1x1_reduce)
        conv3_1_1x1_reduce_bnxx = self.vggface2.vggface2.conv3_1_1x1_reduce_relu(conv3_1_1x1_reduce_bn)
        conv3_1_3x3 = self.vggface2.vggface2.conv3_1_3x3(conv3_1_1x1_reduce_bnxx)
        conv3_1_3x3_bn = self.vggface2.vggface2.conv3_1_3x3_bn(conv3_1_3x3)
        conv3_1_3x3_bnxx = self.vggface2.vggface2.conv3_1_3x3_relu(conv3_1_3x3_bn)
        conv3_1_1x1_increase = self.vggface2.vggface2.conv3_1_1x1_increase(conv3_1_3x3_bnxx)
        conv3_1_1x1_increase_bn = self.vggface2.vggface2.conv3_1_1x1_increase_bn(conv3_1_1x1_increase)
        conv3_1_1x1_proj = self.vggface2.vggface2.conv3_1_1x1_proj(conv2_3x)
        conv3_1_1x1_proj_bn = self.vggface2.vggface2.conv3_1_1x1_proj_bn(conv3_1_1x1_proj)
        conv3_1 = torch.add(conv3_1_1x1_proj_bn, 1, conv3_1_1x1_increase_bn)
        conv3_1x = self.vggface2.vggface2.conv3_1_relu(conv3_1)
        conv3_2_1x1_reduce = self.vggface2.vggface2.conv3_2_1x1_reduce(conv3_1x)
        conv3_2_1x1_reduce_bn = self.vggface2.vggface2.conv3_2_1x1_reduce_bn(conv3_2_1x1_reduce)
        conv3_2_1x1_reduce_bnxx = self.vggface2.vggface2.conv3_2_1x1_reduce_relu(conv3_2_1x1_reduce_bn)
        conv3_2_3x3 = self.vggface2.vggface2.conv3_2_3x3(conv3_2_1x1_reduce_bnxx)
        conv3_2_3x3_bn = self.vggface2.vggface2.conv3_2_3x3_bn(conv3_2_3x3)
        conv3_2_3x3_bnxx = self.vggface2.vggface2.conv3_2_3x3_relu(conv3_2_3x3_bn)
        conv3_2_1x1_increase = self.vggface2.vggface2.conv3_2_1x1_increase(conv3_2_3x3_bnxx)
        conv3_2_1x1_increase_bn = self.vggface2.vggface2.conv3_2_1x1_increase_bn(conv3_2_1x1_increase)
        conv3_2 = torch.add(conv3_1x, 1, conv3_2_1x1_increase_bn)
        conv3_2x = self.vggface2.vggface2.conv3_2_relu(conv3_2)
        conv3_3_1x1_reduce = self.vggface2.vggface2.conv3_3_1x1_reduce(conv3_2x)
        conv3_3_1x1_reduce_bn = self.vggface2.vggface2.conv3_3_1x1_reduce_bn(conv3_3_1x1_reduce)
        conv3_3_1x1_reduce_bnxx = self.vggface2.vggface2.conv3_3_1x1_reduce_relu(conv3_3_1x1_reduce_bn)
        conv3_3_3x3 = self.vggface2.vggface2.conv3_3_3x3(conv3_3_1x1_reduce_bnxx)
        conv3_3_3x3_bn = self.vggface2.vggface2.conv3_3_3x3_bn(conv3_3_3x3)
        conv3_3_3x3_bnxx = self.vggface2.vggface2.conv3_3_3x3_relu(conv3_3_3x3_bn)
        conv3_3_1x1_increase = self.vggface2.vggface2.conv3_3_1x1_increase(conv3_3_3x3_bnxx)
        conv3_3_1x1_increase_bn = self.vggface2.vggface2.conv3_3_1x1_increase_bn(conv3_3_1x1_increase)
        conv3_3 = torch.add(conv3_2x, 1, conv3_3_1x1_increase_bn)
        conv3_3x = self.vggface2.vggface2.conv3_3_relu(conv3_3)
        conv3_4_1x1_reduce = self.vggface2.vggface2.conv3_4_1x1_reduce(conv3_3x)
        conv3_4_1x1_reduce_bn = self.vggface2.vggface2.conv3_4_1x1_reduce_bn(conv3_4_1x1_reduce)
        conv3_4_1x1_reduce_bnxx = self.vggface2.vggface2.conv3_4_1x1_reduce_relu(conv3_4_1x1_reduce_bn)
        conv3_4_3x3 = self.vggface2.vggface2.conv3_4_3x3(conv3_4_1x1_reduce_bnxx)
        conv3_4_3x3_bn = self.vggface2.vggface2.conv3_4_3x3_bn(conv3_4_3x3)
        conv3_4_3x3_bnxx = self.vggface2.vggface2.conv3_4_3x3_relu(conv3_4_3x3_bn)
        conv3_4_1x1_increase = self.vggface2.vggface2.conv3_4_1x1_increase(conv3_4_3x3_bnxx)
        conv3_4_1x1_increase_bn = self.vggface2.vggface2.conv3_4_1x1_increase_bn(conv3_4_1x1_increase)
        conv3_4 = torch.add(conv3_3x, 1, conv3_4_1x1_increase_bn)
        conv3_4x = self.vggface2.vggface2.conv3_4_relu(conv3_4)
        conv4_1_1x1_reduce = self.vggface2.vggface2.conv4_1_1x1_reduce(conv3_4x)
        conv4_1_1x1_reduce_bn = self.vggface2.vggface2.conv4_1_1x1_reduce_bn(conv4_1_1x1_reduce)
        conv4_1_1x1_reduce_bnxx = self.vggface2.vggface2.conv4_1_1x1_reduce_relu(conv4_1_1x1_reduce_bn)
        conv4_1_3x3 = self.vggface2.vggface2.conv4_1_3x3(conv4_1_1x1_reduce_bnxx)
        conv4_1_3x3_bn = self.vggface2.vggface2.conv4_1_3x3_bn(conv4_1_3x3)
        conv4_1_3x3_bnxx = self.vggface2.vggface2.conv4_1_3x3_relu(conv4_1_3x3_bn)
        conv4_1_1x1_increase = self.vggface2.vggface2.conv4_1_1x1_increase(conv4_1_3x3_bnxx)
        conv4_1_1x1_increase_bn = self.vggface2.vggface2.conv4_1_1x1_increase_bn(conv4_1_1x1_increase)
        conv4_1_1x1_proj = self.vggface2.vggface2.conv4_1_1x1_proj(conv3_4x)
        conv4_1_1x1_proj_bn = self.vggface2.vggface2.conv4_1_1x1_proj_bn(conv4_1_1x1_proj)
        conv4_1 = torch.add(conv4_1_1x1_proj_bn, 1, conv4_1_1x1_increase_bn)
        conv4_1x = self.vggface2.vggface2.conv4_1_relu(conv4_1)
        conv4_2_1x1_reduce = self.vggface2.vggface2.conv4_2_1x1_reduce(conv4_1x)
        conv4_2_1x1_reduce_bn = self.vggface2.vggface2.conv4_2_1x1_reduce_bn(conv4_2_1x1_reduce)
        conv4_2_1x1_reduce_bnxx = self.vggface2.vggface2.conv4_2_1x1_reduce_relu(conv4_2_1x1_reduce_bn)
        conv4_2_3x3 = self.vggface2.vggface2.conv4_2_3x3(conv4_2_1x1_reduce_bnxx)
        conv4_2_3x3_bn = self.vggface2.vggface2.conv4_2_3x3_bn(conv4_2_3x3)
        conv4_2_3x3_bnxx = self.vggface2.vggface2.conv4_2_3x3_relu(conv4_2_3x3_bn)
        conv4_2_1x1_increase = self.vggface2.vggface2.conv4_2_1x1_increase(conv4_2_3x3_bnxx)
        conv4_2_1x1_increase_bn = self.vggface2.vggface2.conv4_2_1x1_increase_bn(conv4_2_1x1_increase)
        conv4_2 = torch.add(conv4_1x, 1, conv4_2_1x1_increase_bn)
        conv4_2x = self.vggface2.vggface2.conv4_2_relu(conv4_2)
        conv4_3_1x1_reduce = self.vggface2.vggface2.conv4_3_1x1_reduce(conv4_2x)
        conv4_3_1x1_reduce_bn = self.vggface2.vggface2.conv4_3_1x1_reduce_bn(conv4_3_1x1_reduce)
        conv4_3_1x1_reduce_bnxx = self.vggface2.vggface2.conv4_3_1x1_reduce_relu(conv4_3_1x1_reduce_bn)
        conv4_3_3x3 = self.vggface2.vggface2.conv4_3_3x3(conv4_3_1x1_reduce_bnxx)
        conv4_3_3x3_bn = self.vggface2.vggface2.conv4_3_3x3_bn(conv4_3_3x3)
        conv4_3_3x3_bnxx = self.vggface2.vggface2.conv4_3_3x3_relu(conv4_3_3x3_bn)
        conv4_3_1x1_increase = self.vggface2.vggface2.conv4_3_1x1_increase(conv4_3_3x3_bnxx)
        conv4_3_1x1_increase_bn = self.vggface2.vggface2.conv4_3_1x1_increase_bn(conv4_3_1x1_increase)
        conv4_3 = torch.add(conv4_2x, 1, conv4_3_1x1_increase_bn)
        conv4_3x = self.vggface2.vggface2.conv4_3_relu(conv4_3)
        conv4_4_1x1_reduce = self.vggface2.vggface2.conv4_4_1x1_reduce(conv4_3x)
        conv4_4_1x1_reduce_bn = self.vggface2.vggface2.conv4_4_1x1_reduce_bn(conv4_4_1x1_reduce)
        conv4_4_1x1_reduce_bnxx = self.vggface2.vggface2.conv4_4_1x1_reduce_relu(conv4_4_1x1_reduce_bn)
        conv4_4_3x3 = self.vggface2.vggface2.conv4_4_3x3(conv4_4_1x1_reduce_bnxx)
        conv4_4_3x3_bn = self.vggface2.vggface2.conv4_4_3x3_bn(conv4_4_3x3)
        conv4_4_3x3_bnxx = self.vggface2.vggface2.conv4_4_3x3_relu(conv4_4_3x3_bn)
        conv4_4_1x1_increase = self.vggface2.vggface2.conv4_4_1x1_increase(conv4_4_3x3_bnxx)
        conv4_4_1x1_increase_bn = self.vggface2.vggface2.conv4_4_1x1_increase_bn(conv4_4_1x1_increase)
        conv4_4 = torch.add(conv4_3x, 1, conv4_4_1x1_increase_bn)
        conv4_4x = self.vggface2.vggface2.conv4_4_relu(conv4_4)
        conv4_5_1x1_reduce = self.vggface2.vggface2.conv4_5_1x1_reduce(conv4_4x)
        conv4_5_1x1_reduce_bn = self.vggface2.vggface2.conv4_5_1x1_reduce_bn(conv4_5_1x1_reduce)
        conv4_5_1x1_reduce_bnxx = self.vggface2.vggface2.conv4_5_1x1_reduce_relu(conv4_5_1x1_reduce_bn)
        conv4_5_3x3 = self.vggface2.vggface2.conv4_5_3x3(conv4_5_1x1_reduce_bnxx)
        conv4_5_3x3_bn = self.vggface2.vggface2.conv4_5_3x3_bn(conv4_5_3x3)
        conv4_5_3x3_bnxx = self.vggface2.vggface2.conv4_5_3x3_relu(conv4_5_3x3_bn)
        conv4_5_1x1_increase = self.vggface2.vggface2.conv4_5_1x1_increase(conv4_5_3x3_bnxx)
        conv4_5_1x1_increase_bn = self.vggface2.vggface2.conv4_5_1x1_increase_bn(conv4_5_1x1_increase)
        conv4_5 = torch.add(conv4_4x, 1, conv4_5_1x1_increase_bn)
        conv4_5x = self.vggface2.vggface2.conv4_5_relu(conv4_5)
        conv4_6_1x1_reduce = self.vggface2.vggface2.conv4_6_1x1_reduce(conv4_5x)
        conv4_6_1x1_reduce_bn = self.vggface2.vggface2.conv4_6_1x1_reduce_bn(conv4_6_1x1_reduce)
        conv4_6_1x1_reduce_bnxx = self.vggface2.vggface2.conv4_6_1x1_reduce_relu(conv4_6_1x1_reduce_bn)
        conv4_6_3x3 = self.vggface2.vggface2.conv4_6_3x3(conv4_6_1x1_reduce_bnxx)
        conv4_6_3x3_bn = self.vggface2.vggface2.conv4_6_3x3_bn(conv4_6_3x3)
        conv4_6_3x3_bnxx = self.vggface2.vggface2.conv4_6_3x3_relu(conv4_6_3x3_bn)
        conv4_6_1x1_increase = self.vggface2.vggface2.conv4_6_1x1_increase(conv4_6_3x3_bnxx)
        conv4_6_1x1_increase_bn = self.vggface2.vggface2.conv4_6_1x1_increase_bn(conv4_6_1x1_increase)
        conv4_6 = torch.add(conv4_5x, 1, conv4_6_1x1_increase_bn)
        conv4_6x = self.vggface2.vggface2.conv4_6_relu(conv4_6)

        conv5_1_1x1_reduce = self.vggface2.vggface2.conv5_1_1x1_reduce(conv4_6x)
        conv5_1_1x1_reduce_bn = self.vggface2.vggface2.conv5_1_1x1_reduce_bn(conv5_1_1x1_reduce)
        conv5_1_1x1_reduce_bnxx = self.vggface2.vggface2.conv5_1_1x1_reduce_relu(conv5_1_1x1_reduce_bn)

        ### replace
        conv5_1_3x3 = self.vggface2.vggface2.conv5_1_3x3(conv5_1_1x1_reduce_bnxx)
        # conv5_1_3x3 = self.mhsa_c5_1(conv5_1_1x1_reduce_bnxx)
        ###
        conv5_1_3x3_bn = self.vggface2.vggface2.conv5_1_3x3_bn(conv5_1_3x3)
        conv5_1_3x3_bnxx = self.vggface2.vggface2.conv5_1_3x3_relu(conv5_1_3x3_bn)

        conv5_1_1x1_increase = self.vggface2.vggface2.conv5_1_1x1_increase(conv5_1_3x3_bnxx)
        conv5_1_1x1_increase_bn = self.vggface2.vggface2.conv5_1_1x1_increase_bn(conv5_1_1x1_increase)
        conv5_1_1x1_proj = self.vggface2.vggface2.conv5_1_1x1_proj(conv4_6x)
        conv5_1_1x1_proj_bn = self.vggface2.vggface2.conv5_1_1x1_proj_bn(conv5_1_1x1_proj)
        conv5_1 = torch.add(conv5_1_1x1_proj_bn, 1, conv5_1_1x1_increase_bn)
        conv5_1x = self.vggface2.vggface2.conv5_1_relu(conv5_1)
        conv5_2_1x1_reduce = self.vggface2.vggface2.conv5_2_1x1_reduce(conv5_1x)
        conv5_2_1x1_reduce_bn = self.vggface2.vggface2.conv5_2_1x1_reduce_bn(conv5_2_1x1_reduce)
        conv5_2_1x1_reduce_bnxx = self.vggface2.vggface2.conv5_2_1x1_reduce_relu(conv5_2_1x1_reduce_bn)

        ### replace
        conv5_2_3x3 = self.vggface2.vggface2.conv5_2_3x3(conv5_2_1x1_reduce_bnxx)
        # conv5_2_3x3 = self.mhsa_c5_2(conv5_2_1x1_reduce_bnxx)
        ###
        conv5_2_3x3_bn = self.vggface2.vggface2.conv5_2_3x3_bn(conv5_2_3x3)
        conv5_2_3x3_bnxx = self.vggface2.vggface2.conv5_2_3x3_relu(conv5_2_3x3_bn)

        conv5_2_1x1_increase = self.vggface2.vggface2.conv5_2_1x1_increase(conv5_2_3x3_bnxx)
        conv5_2_1x1_increase_bn = self.vggface2.vggface2.conv5_2_1x1_increase_bn(conv5_2_1x1_increase)
        conv5_2 = torch.add(conv5_1x, 1, conv5_2_1x1_increase_bn)
        conv5_2x = self.vggface2.vggface2.conv5_2_relu(conv5_2)
        conv5_3_1x1_reduce = self.vggface2.vggface2.conv5_3_1x1_reduce(conv5_2x)
        conv5_3_1x1_reduce_bn = self.vggface2.vggface2.conv5_3_1x1_reduce_bn(conv5_3_1x1_reduce)
        conv5_3_1x1_reduce_bnxx = self.vggface2.vggface2.conv5_3_1x1_reduce_relu(conv5_3_1x1_reduce_bn)

        ### replace
        conv5_3_3x3 = self.vggface2.vggface2.conv5_3_3x3(conv5_3_1x1_reduce_bnxx)
        # conv5_3_3x3 = self.mhsa_c5_3(conv5_3_1x1_reduce_bnxx)
        ###
        conv5_3_3x3_bn = self.vggface2.vggface2.conv5_3_3x3_bn(conv5_3_3x3)
        conv5_3_3x3_bnxx = self.vggface2.vggface2.conv5_3_3x3_relu(conv5_3_3x3_bn)


        conv5_3_1x1_increase = self.vggface2.vggface2.conv5_3_1x1_increase(conv5_3_3x3_bnxx)
        conv5_3_1x1_increase_bn = self.vggface2.vggface2.conv5_3_1x1_increase_bn(conv5_3_1x1_increase)
        conv5_3 = torch.add(conv5_2x, 1, conv5_3_1x1_increase_bn)
        conv5_3x = self.vggface2.vggface2.conv5_3_relu(conv5_3)
        pool5_7x7_s1 = self.vggface2.vggface2.pool5_7x7_s1(conv5_3x)

        classifier_flatten = pool5_7x7_s1.view(pool5_7x7_s1.size(0), -1)
        # classifier_flatten = torch.flatten(pool5_7x7_s1)
        classifier = self.vggface2.vggface2.classifier(classifier_flatten)

        return classifier


class VGGFace2BotS1(nn.Module):

    def __init__(self, classes=7):
        super().__init__()

        vggface2_full = model.VGGFace2(pretrained = True, classes = classes)
        # vggface2_full = model.VGGFace2(pretrained = False, classes = classes)

        vggface2_list = list(vggface2_full.vggface2.children())

        vggface2_c2_c4 = vggface2_list[:-31]
        vggface2_classifier = vggface2_list[-2:]

        botblock_c5 = bot_block.BottleStack(
            dim = 1024,              # channels in
            fmap_size = 14,         # feature map size
            dim_out = 2048,         # channels out
            proj_factor = 4,        # projection factor
            downsample = True,      # downsample on first layer or not
            heads = 4,              # number of heads
            dim_head = 128,         # dimension per head, defaults to 128
            rel_pos_emb = True,    # use relative positional embedding - uses absolute if False
            activation = nn.ReLU()  # activation throughout the network
        )

        vggface2_c2_c4_names = ["conv1_7x7_s2", "conv1_7x7_s2_bn", "conv1_relu_7x7_s2", "pool1_3x3_s2", "conv2_1_1x1_reduce", "conv2_1_1x1_reduce_bn", "conv2_1_1x1_reduce_relu", "conv2_1_3x3", "conv2_1_3x3_bn", "conv2_1_3x3_relu", "conv2_1_1x1_increase", "conv2_1_1x1_increase_bn", "conv2_1_1x1_proj", "conv2_1_1x1_proj_bn", "conv2_1_relu", "conv2_2_1x1_reduce", "conv2_2_1x1_reduce_bn", "conv2_2_1x1_reduce_relu", "conv2_2_3x3", "conv2_2_3x3_bn", "conv2_2_3x3_relu", "conv2_2_1x1_increase", "conv2_2_1x1_increase_bn", "conv2_2_relu", "conv2_3_1x1_reduce", "conv2_3_1x1_reduce_bn", "conv2_3_1x1_reduce_relu", "conv2_3_3x3", "conv2_3_3x3_bn", "conv2_3_3x3_relu", "conv2_3_1x1_increase", "conv2_3_1x1_increase_bn", "conv2_3_relu", "conv3_1_1x1_reduce", "conv3_1_1x1_reduce_bn", "conv3_1_1x1_reduce_relu", "conv3_1_3x3", "conv3_1_3x3_bn", "conv3_1_3x3_relu", "conv3_1_1x1_increase", "conv3_1_1x1_increase_bn", "conv3_1_1x1_proj", "conv3_1_1x1_proj_bn", "conv3_1_relu", "conv3_2_1x1_reduce", "conv3_2_1x1_reduce_bn", "conv3_2_1x1_reduce_relu", "conv3_2_3x3", "conv3_2_3x3_bn", "conv3_2_3x3_relu", "conv3_2_1x1_increase", "conv3_2_1x1_increase_bn", "conv3_2_relu", "conv3_3_1x1_reduce", "conv3_3_1x1_reduce_bn", "conv3_3_1x1_reduce_relu", "conv3_3_3x3", "conv3_3_3x3_bn", "conv3_3_3x3_relu", "conv3_3_1x1_increase", "conv3_3_1x1_increase_bn", "conv3_3_relu", "conv3_4_1x1_reduce", "conv3_4_1x1_reduce_bn", "conv3_4_1x1_reduce_relu", "conv3_4_3x3", "conv3_4_3x3_bn", "conv3_4_3x3_relu", "conv3_4_1x1_increase", "conv3_4_1x1_increase_bn", "conv3_4_relu", "conv4_1_1x1_reduce", "conv4_1_1x1_reduce_bn", "conv4_1_1x1_reduce_relu", "conv4_1_3x3", "conv4_1_3x3_bn", "conv4_1_3x3_relu", "conv4_1_1x1_increase", "conv4_1_1x1_increase_bn", "conv4_1_1x1_proj", "conv4_1_1x1_proj_bn", "conv4_1_relu", "conv4_2_1x1_reduce", "conv4_2_1x1_reduce_bn", "conv4_2_1x1_reduce_relu", "conv4_2_3x3", "conv4_2_3x3_bn", "conv4_2_3x3_relu", "conv4_2_1x1_increase", "conv4_2_1x1_increase_bn", "conv4_2_relu", "conv4_3_1x1_reduce", "conv4_3_1x1_reduce_bn", "conv4_3_1x1_reduce_relu", "conv4_3_3x3", "conv4_3_3x3_bn", "conv4_3_3x3_relu", "conv4_3_1x1_increase", "conv4_3_1x1_increase_bn", "conv4_3_relu", "conv4_4_1x1_reduce", "conv4_4_1x1_reduce_bn", "conv4_4_1x1_reduce_relu", "conv4_4_3x3", "conv4_4_3x3_bn", "conv4_4_3x3_relu", "conv4_4_1x1_increase", "conv4_4_1x1_increase_bn", "conv4_4_relu", "conv4_5_1x1_reduce", "conv4_5_1x1_reduce_bn", "conv4_5_1x1_reduce_relu", "conv4_5_3x3", "conv4_5_3x3_bn", "conv4_5_3x3_relu", "conv4_5_1x1_increase", "conv4_5_1x1_increase_bn", "conv4_5_relu", "conv4_6_1x1_reduce", "conv4_6_1x1_reduce_bn", "conv4_6_1x1_reduce_relu", "conv4_6_3x3", "conv4_6_3x3_bn", "conv4_6_3x3_relu", "conv4_6_1x1_increase", "conv4_6_1x1_increase_bn", "conv4_6_relu"]
        layers_dict = OrderedDict(zip(vggface2_c2_c4_names, vggface2_c2_c4))
        layers_dict["botblock5"] = botblock_c5
        layers_dict["pool5_7x7_s1"] = vggface2_classifier[0]
        layers_dict["classifier"] = vggface2_classifier[1]

        self.model = nn.Sequential(
            layers_dict
        )

        # self.vggface2 = model.VGGFace2(pretrained=True, classes=classes)
        #
        # mhsa_c5_1_1 = bot_module.MHSA(512, width = 14, height = 14, heads = 4)
        # mhsa_c5_1_2 = bot_module.MHSA(512, width = 7, height = 7, heads = 4)
        # mhsa_c5_1_3 = bot_module.MHSA(512, width = 7, height = 7, heads = 4)
        #
        # mhsa_c5_2_1 = bot_module.MHSA(512, width = 14, height = 14, heads = 4)
        # mhsa_c5_2_2 = bot_module.MHSA(512, width = 7, height = 7, heads = 4)
        # mhsa_c5_2_3 = bot_module.MHSA(512, width = 7, height = 7, heads = 4)
        #
        # mhsa_c5_3_1 = bot_module.MHSA(512, width = 14, height = 14, heads = 4)
        # mhsa_c5_3_2 = bot_module.MHSA(512, width = 7, height = 7, heads = 4)
        # mhsa_c5_3_3 = bot_module.MHSA(512, width = 7, height = 7, heads = 4)
        #
        # self.vggface2.vggface2.conv5_1_1x1_reduce = mhsa_c5_1_1
        # self.vggface2.vggface2.conv5_1_3x3 = mhsa_c5_1_2
        # self.vggface2.vggface2.conv5_1_1x1_increase = mhsa_c5_1_3
        #
        # self.vggface2.vggface2.conv5_2_1x1_reduce = mhsa_c5_2_1
        # self.vggface2.vggface2.conv5_2_3x3 = mhsa_c5_2_2
        # self.vggface2.vggface2.conv5_2_1x1_increase = mhsa_c5_2_3
        #
        # self.vggface2.vggface2.conv5_3_1x1_reduce = mhsa_c5_3_1
        # self.vggface2.vggface2.conv5_3_3x3 = mhsa_c5_3_2
        # self.vggface2.vggface2.conv5_3_1x1_increase = mhsa_c5_3_3

    def forward(self, data):

        conv1_7x7_s2 = self.model.conv1_7x7_s2(data)
        conv1_7x7_s2_bn = self.model.conv1_7x7_s2_bn(conv1_7x7_s2)
        conv1_7x7_s2_bnxx = self.model.conv1_relu_7x7_s2(conv1_7x7_s2_bn)
        pool1_3x3_s2 = self.model.pool1_3x3_s2(conv1_7x7_s2_bnxx)
        conv2_1_1x1_reduce = self.model.conv2_1_1x1_reduce(pool1_3x3_s2)
        conv2_1_1x1_reduce_bn = self.model.conv2_1_1x1_reduce_bn(conv2_1_1x1_reduce)
        conv2_1_1x1_reduce_bnxx = self.model.conv2_1_1x1_reduce_relu(conv2_1_1x1_reduce_bn)
        conv2_1_3x3 = self.model.conv2_1_3x3(conv2_1_1x1_reduce_bnxx)
        conv2_1_3x3_bn = self.model.conv2_1_3x3_bn(conv2_1_3x3)
        conv2_1_3x3_bnxx = self.model.conv2_1_3x3_relu(conv2_1_3x3_bn)
        conv2_1_1x1_increase = self.model.conv2_1_1x1_increase(conv2_1_3x3_bnxx)
        conv2_1_1x1_increase_bn = self.model.conv2_1_1x1_increase_bn(conv2_1_1x1_increase)
        conv2_1_1x1_proj = self.model.conv2_1_1x1_proj(pool1_3x3_s2)
        conv2_1_1x1_proj_bn = self.model.conv2_1_1x1_proj_bn(conv2_1_1x1_proj)
        conv2_1 = torch.add(conv2_1_1x1_proj_bn, 1, conv2_1_1x1_increase_bn)
        conv2_1x = self.model.conv2_1_relu(conv2_1)
        conv2_2_1x1_reduce = self.model.conv2_2_1x1_reduce(conv2_1x)
        conv2_2_1x1_reduce_bn = self.model.conv2_2_1x1_reduce_bn(conv2_2_1x1_reduce)
        conv2_2_1x1_reduce_bnxx = self.model.conv2_2_1x1_reduce_relu(conv2_2_1x1_reduce_bn)
        conv2_2_3x3 = self.model.conv2_2_3x3(conv2_2_1x1_reduce_bnxx)
        conv2_2_3x3_bn = self.model.conv2_2_3x3_bn(conv2_2_3x3)
        conv2_2_3x3_bnxx = self.model.conv2_2_3x3_relu(conv2_2_3x3_bn)
        conv2_2_1x1_increase = self.model.conv2_2_1x1_increase(conv2_2_3x3_bnxx)
        conv2_2_1x1_increase_bn = self.model.conv2_2_1x1_increase_bn(conv2_2_1x1_increase)
        conv2_2 = torch.add(conv2_1x, 1, conv2_2_1x1_increase_bn)
        conv2_2x = self.model.conv2_2_relu(conv2_2)
        conv2_3_1x1_reduce = self.model.conv2_3_1x1_reduce(conv2_2x)
        conv2_3_1x1_reduce_bn = self.model.conv2_3_1x1_reduce_bn(conv2_3_1x1_reduce)
        conv2_3_1x1_reduce_bnxx = self.model.conv2_3_1x1_reduce_relu(conv2_3_1x1_reduce_bn)
        conv2_3_3x3 = self.model.conv2_3_3x3(conv2_3_1x1_reduce_bnxx)
        conv2_3_3x3_bn = self.model.conv2_3_3x3_bn(conv2_3_3x3)
        conv2_3_3x3_bnxx = self.model.conv2_3_3x3_relu(conv2_3_3x3_bn)
        conv2_3_1x1_increase = self.model.conv2_3_1x1_increase(conv2_3_3x3_bnxx)
        conv2_3_1x1_increase_bn = self.model.conv2_3_1x1_increase_bn(conv2_3_1x1_increase)
        conv2_3 = torch.add(conv2_2x, 1, conv2_3_1x1_increase_bn)
        conv2_3x = self.model.conv2_3_relu(conv2_3)
        conv3_1_1x1_reduce = self.model.conv3_1_1x1_reduce(conv2_3x)
        conv3_1_1x1_reduce_bn = self.model.conv3_1_1x1_reduce_bn(conv3_1_1x1_reduce)
        conv3_1_1x1_reduce_bnxx = self.model.conv3_1_1x1_reduce_relu(conv3_1_1x1_reduce_bn)
        conv3_1_3x3 = self.model.conv3_1_3x3(conv3_1_1x1_reduce_bnxx)
        conv3_1_3x3_bn = self.model.conv3_1_3x3_bn(conv3_1_3x3)
        conv3_1_3x3_bnxx = self.model.conv3_1_3x3_relu(conv3_1_3x3_bn)
        conv3_1_1x1_increase = self.model.conv3_1_1x1_increase(conv3_1_3x3_bnxx)
        conv3_1_1x1_increase_bn = self.model.conv3_1_1x1_increase_bn(conv3_1_1x1_increase)
        conv3_1_1x1_proj = self.model.conv3_1_1x1_proj(conv2_3x)
        conv3_1_1x1_proj_bn = self.model.conv3_1_1x1_proj_bn(conv3_1_1x1_proj)
        conv3_1 = torch.add(conv3_1_1x1_proj_bn, 1, conv3_1_1x1_increase_bn)
        conv3_1x = self.model.conv3_1_relu(conv3_1)
        conv3_2_1x1_reduce = self.model.conv3_2_1x1_reduce(conv3_1x)
        conv3_2_1x1_reduce_bn = self.model.conv3_2_1x1_reduce_bn(conv3_2_1x1_reduce)
        conv3_2_1x1_reduce_bnxx = self.model.conv3_2_1x1_reduce_relu(conv3_2_1x1_reduce_bn)
        conv3_2_3x3 = self.model.conv3_2_3x3(conv3_2_1x1_reduce_bnxx)
        conv3_2_3x3_bn = self.model.conv3_2_3x3_bn(conv3_2_3x3)
        conv3_2_3x3_bnxx = self.model.conv3_2_3x3_relu(conv3_2_3x3_bn)
        conv3_2_1x1_increase = self.model.conv3_2_1x1_increase(conv3_2_3x3_bnxx)
        conv3_2_1x1_increase_bn = self.model.conv3_2_1x1_increase_bn(conv3_2_1x1_increase)
        conv3_2 = torch.add(conv3_1x, 1, conv3_2_1x1_increase_bn)
        conv3_2x = self.model.conv3_2_relu(conv3_2)
        conv3_3_1x1_reduce = self.model.conv3_3_1x1_reduce(conv3_2x)
        conv3_3_1x1_reduce_bn = self.model.conv3_3_1x1_reduce_bn(conv3_3_1x1_reduce)
        conv3_3_1x1_reduce_bnxx = self.model.conv3_3_1x1_reduce_relu(conv3_3_1x1_reduce_bn)
        conv3_3_3x3 = self.model.conv3_3_3x3(conv3_3_1x1_reduce_bnxx)
        conv3_3_3x3_bn = self.model.conv3_3_3x3_bn(conv3_3_3x3)
        conv3_3_3x3_bnxx = self.model.conv3_3_3x3_relu(conv3_3_3x3_bn)
        conv3_3_1x1_increase = self.model.conv3_3_1x1_increase(conv3_3_3x3_bnxx)
        conv3_3_1x1_increase_bn = self.model.conv3_3_1x1_increase_bn(conv3_3_1x1_increase)
        conv3_3 = torch.add(conv3_2x, 1, conv3_3_1x1_increase_bn)
        conv3_3x = self.model.conv3_3_relu(conv3_3)
        conv3_4_1x1_reduce = self.model.conv3_4_1x1_reduce(conv3_3x)
        conv3_4_1x1_reduce_bn = self.model.conv3_4_1x1_reduce_bn(conv3_4_1x1_reduce)
        conv3_4_1x1_reduce_bnxx = self.model.conv3_4_1x1_reduce_relu(conv3_4_1x1_reduce_bn)
        conv3_4_3x3 = self.model.conv3_4_3x3(conv3_4_1x1_reduce_bnxx)
        conv3_4_3x3_bn = self.model.conv3_4_3x3_bn(conv3_4_3x3)
        conv3_4_3x3_bnxx = self.model.conv3_4_3x3_relu(conv3_4_3x3_bn)
        conv3_4_1x1_increase = self.model.conv3_4_1x1_increase(conv3_4_3x3_bnxx)
        conv3_4_1x1_increase_bn = self.model.conv3_4_1x1_increase_bn(conv3_4_1x1_increase)
        conv3_4 = torch.add(conv3_3x, 1, conv3_4_1x1_increase_bn)
        conv3_4x = self.model.conv3_4_relu(conv3_4)
        conv4_1_1x1_reduce = self.model.conv4_1_1x1_reduce(conv3_4x)
        conv4_1_1x1_reduce_bn = self.model.conv4_1_1x1_reduce_bn(conv4_1_1x1_reduce)
        conv4_1_1x1_reduce_bnxx = self.model.conv4_1_1x1_reduce_relu(conv4_1_1x1_reduce_bn)
        conv4_1_3x3 = self.model.conv4_1_3x3(conv4_1_1x1_reduce_bnxx)
        conv4_1_3x3_bn = self.model.conv4_1_3x3_bn(conv4_1_3x3)
        conv4_1_3x3_bnxx = self.model.conv4_1_3x3_relu(conv4_1_3x3_bn)
        conv4_1_1x1_increase = self.model.conv4_1_1x1_increase(conv4_1_3x3_bnxx)
        conv4_1_1x1_increase_bn = self.model.conv4_1_1x1_increase_bn(conv4_1_1x1_increase)
        conv4_1_1x1_proj = self.model.conv4_1_1x1_proj(conv3_4x)
        conv4_1_1x1_proj_bn = self.model.conv4_1_1x1_proj_bn(conv4_1_1x1_proj)
        conv4_1 = torch.add(conv4_1_1x1_proj_bn, 1, conv4_1_1x1_increase_bn)
        conv4_1x = self.model.conv4_1_relu(conv4_1)
        conv4_2_1x1_reduce = self.model.conv4_2_1x1_reduce(conv4_1x)
        conv4_2_1x1_reduce_bn = self.model.conv4_2_1x1_reduce_bn(conv4_2_1x1_reduce)
        conv4_2_1x1_reduce_bnxx = self.model.conv4_2_1x1_reduce_relu(conv4_2_1x1_reduce_bn)
        conv4_2_3x3 = self.model.conv4_2_3x3(conv4_2_1x1_reduce_bnxx)
        conv4_2_3x3_bn = self.model.conv4_2_3x3_bn(conv4_2_3x3)
        conv4_2_3x3_bnxx = self.model.conv4_2_3x3_relu(conv4_2_3x3_bn)
        conv4_2_1x1_increase = self.model.conv4_2_1x1_increase(conv4_2_3x3_bnxx)
        conv4_2_1x1_increase_bn = self.model.conv4_2_1x1_increase_bn(conv4_2_1x1_increase)
        conv4_2 = torch.add(conv4_1x, 1, conv4_2_1x1_increase_bn)
        conv4_2x = self.model.conv4_2_relu(conv4_2)
        conv4_3_1x1_reduce = self.model.conv4_3_1x1_reduce(conv4_2x)
        conv4_3_1x1_reduce_bn = self.model.conv4_3_1x1_reduce_bn(conv4_3_1x1_reduce)
        conv4_3_1x1_reduce_bnxx = self.model.conv4_3_1x1_reduce_relu(conv4_3_1x1_reduce_bn)
        conv4_3_3x3 = self.model.conv4_3_3x3(conv4_3_1x1_reduce_bnxx)
        conv4_3_3x3_bn = self.model.conv4_3_3x3_bn(conv4_3_3x3)
        conv4_3_3x3_bnxx = self.model.conv4_3_3x3_relu(conv4_3_3x3_bn)
        conv4_3_1x1_increase = self.model.conv4_3_1x1_increase(conv4_3_3x3_bnxx)
        conv4_3_1x1_increase_bn = self.model.conv4_3_1x1_increase_bn(conv4_3_1x1_increase)
        conv4_3 = torch.add(conv4_2x, 1, conv4_3_1x1_increase_bn)
        conv4_3x = self.model.conv4_3_relu(conv4_3)
        conv4_4_1x1_reduce = self.model.conv4_4_1x1_reduce(conv4_3x)
        conv4_4_1x1_reduce_bn = self.model.conv4_4_1x1_reduce_bn(conv4_4_1x1_reduce)
        conv4_4_1x1_reduce_bnxx = self.model.conv4_4_1x1_reduce_relu(conv4_4_1x1_reduce_bn)
        conv4_4_3x3 = self.model.conv4_4_3x3(conv4_4_1x1_reduce_bnxx)
        conv4_4_3x3_bn = self.model.conv4_4_3x3_bn(conv4_4_3x3)
        conv4_4_3x3_bnxx = self.model.conv4_4_3x3_relu(conv4_4_3x3_bn)
        conv4_4_1x1_increase = self.model.conv4_4_1x1_increase(conv4_4_3x3_bnxx)
        conv4_4_1x1_increase_bn = self.model.conv4_4_1x1_increase_bn(conv4_4_1x1_increase)
        conv4_4 = torch.add(conv4_3x, 1, conv4_4_1x1_increase_bn)
        conv4_4x = self.model.conv4_4_relu(conv4_4)
        conv4_5_1x1_reduce = self.model.conv4_5_1x1_reduce(conv4_4x)
        conv4_5_1x1_reduce_bn = self.model.conv4_5_1x1_reduce_bn(conv4_5_1x1_reduce)
        conv4_5_1x1_reduce_bnxx = self.model.conv4_5_1x1_reduce_relu(conv4_5_1x1_reduce_bn)
        conv4_5_3x3 = self.model.conv4_5_3x3(conv4_5_1x1_reduce_bnxx)
        conv4_5_3x3_bn = self.model.conv4_5_3x3_bn(conv4_5_3x3)
        conv4_5_3x3_bnxx = self.model.conv4_5_3x3_relu(conv4_5_3x3_bn)
        conv4_5_1x1_increase = self.model.conv4_5_1x1_increase(conv4_5_3x3_bnxx)
        conv4_5_1x1_increase_bn = self.model.conv4_5_1x1_increase_bn(conv4_5_1x1_increase)
        conv4_5 = torch.add(conv4_4x, 1, conv4_5_1x1_increase_bn)
        conv4_5x = self.model.conv4_5_relu(conv4_5)
        conv4_6_1x1_reduce = self.model.conv4_6_1x1_reduce(conv4_5x)
        conv4_6_1x1_reduce_bn = self.model.conv4_6_1x1_reduce_bn(conv4_6_1x1_reduce)
        conv4_6_1x1_reduce_bnxx = self.model.conv4_6_1x1_reduce_relu(conv4_6_1x1_reduce_bn)
        conv4_6_3x3 = self.model.conv4_6_3x3(conv4_6_1x1_reduce_bnxx)
        conv4_6_3x3_bn = self.model.conv4_6_3x3_bn(conv4_6_3x3)
        conv4_6_3x3_bnxx = self.model.conv4_6_3x3_relu(conv4_6_3x3_bn)
        conv4_6_1x1_increase = self.model.conv4_6_1x1_increase(conv4_6_3x3_bnxx)
        conv4_6_1x1_increase_bn = self.model.conv4_6_1x1_increase_bn(conv4_6_1x1_increase)
        conv4_6 = torch.add(conv4_5x, 1, conv4_6_1x1_increase_bn)
        conv4_6x = self.model.conv4_6_relu(conv4_6)

        # conv5_1_1x1_reduce = self.vggface2.vggface2.conv5_1_1x1_reduce(conv4_6x)
        # conv5_1_1x1_reduce_bn = self.vggface2.vggface2.conv5_1_1x1_reduce_bn(conv5_1_1x1_reduce)
        # conv5_1_1x1_reduce_bnxx = self.vggface2.vggface2.conv5_1_1x1_reduce_relu(conv5_1_1x1_reduce_bn)
        #
        # ### replace
        # conv5_1_3x3 = self.vggface2.vggface2.conv5_1_3x3(conv5_1_1x1_reduce_bnxx)
        # # conv5_1_3x3 = self.mhsa_c5_1(conv5_1_1x1_reduce_bnxx)
        # ###
        # conv5_1_3x3_bn = self.vggface2.vggface2.conv5_1_3x3_bn(conv5_1_3x3)
        # conv5_1_3x3_bnxx = self.vggface2.vggface2.conv5_1_3x3_relu(conv5_1_3x3_bn)
        #
        # conv5_1_1x1_increase = self.vggface2.vggface2.conv5_1_1x1_increase(conv5_1_3x3_bnxx)
        # conv5_1_1x1_increase_bn = self.vggface2.vggface2.conv5_1_1x1_increase_bn(conv5_1_1x1_increase)
        # conv5_1_1x1_proj = self.vggface2.vggface2.conv5_1_1x1_proj(conv4_6x)
        # conv5_1_1x1_proj_bn = self.vggface2.vggface2.conv5_1_1x1_proj_bn(conv5_1_1x1_proj)
        # conv5_1 = torch.add(conv5_1_1x1_proj_bn, 1, conv5_1_1x1_increase_bn)
        # conv5_1x = self.vggface2.vggface2.conv5_1_relu(conv5_1)
        # conv5_2_1x1_reduce = self.vggface2.vggface2.conv5_2_1x1_reduce(conv5_1x)
        # conv5_2_1x1_reduce_bn = self.vggface2.vggface2.conv5_2_1x1_reduce_bn(conv5_2_1x1_reduce)
        # conv5_2_1x1_reduce_bnxx = self.vggface2.vggface2.conv5_2_1x1_reduce_relu(conv5_2_1x1_reduce_bn)
        #
        # ### replace
        # conv5_2_3x3 = self.vggface2.vggface2.conv5_2_3x3(conv5_2_1x1_reduce_bnxx)
        # # conv5_2_3x3 = self.mhsa_c5_2(conv5_2_1x1_reduce_bnxx)
        # ###
        # conv5_2_3x3_bn = self.vggface2.vggface2.conv5_2_3x3_bn(conv5_2_3x3)
        # conv5_2_3x3_bnxx = self.vggface2.vggface2.conv5_2_3x3_relu(conv5_2_3x3_bn)
        #
        # conv5_2_1x1_increase = self.vggface2.vggface2.conv5_2_1x1_increase(conv5_2_3x3_bnxx)
        # conv5_2_1x1_increase_bn = self.vggface2.vggface2.conv5_2_1x1_increase_bn(conv5_2_1x1_increase)
        # conv5_2 = torch.add(conv5_1x, 1, conv5_2_1x1_increase_bn)
        # conv5_2x = self.vggface2.vggface2.conv5_2_relu(conv5_2)
        # conv5_3_1x1_reduce = self.vggface2.vggface2.conv5_3_1x1_reduce(conv5_2x)
        # conv5_3_1x1_reduce_bn = self.vggface2.vggface2.conv5_3_1x1_reduce_bn(conv5_3_1x1_reduce)
        # conv5_3_1x1_reduce_bnxx = self.vggface2.vggface2.conv5_3_1x1_reduce_relu(conv5_3_1x1_reduce_bn)
        #
        # ### replace
        # conv5_3_3x3 = self.vggface2.vggface2.conv5_3_3x3(conv5_3_1x1_reduce_bnxx)
        # # conv5_3_3x3 = self.mhsa_c5_3(conv5_3_1x1_reduce_bnxx)
        # ###
        # conv5_3_3x3_bn = self.vggface2.vggface2.conv5_3_3x3_bn(conv5_3_3x3)
        # conv5_3_3x3_bnxx = self.vggface2.vggface2.conv5_3_3x3_relu(conv5_3_3x3_bn)
        #
        #
        # conv5_3_1x1_increase = self.vggface2.vggface2.conv5_3_1x1_increase(conv5_3_3x3_bnxx)
        # conv5_3_1x1_increase_bn = self.vggface2.vggface2.conv5_3_1x1_increase_bn(conv5_3_1x1_increase)
        # conv5_3 = torch.add(conv5_2x, 1, conv5_3_1x1_increase_bn)
        # conv5_3x = self.vggface2.vggface2.conv5_3_relu(conv5_3)

        botblock5x = self.model.botblock5(conv4_6x)
        pool5_7x7_s1 = self.model.pool5_7x7_s1(botblock5x)
        classifier_flatten = pool5_7x7_s1.view(pool5_7x7_s1.size(0), -1)
        # classifier_flatten = torch.flatten(pool5_7x7_s1)
        classifier = self.model.classifier(classifier_flatten)

        return classifier
        # conv1_7x7_s2 = self.vggface2.vggface2.conv1_7x7_s2(data)
        # conv1_7x7_s2_bn = self.vggface2.vggface2.conv1_7x7_s2_bn(conv1_7x7_s2)
        # conv1_7x7_s2_bnxx = self.vggface2.vggface2.conv1_relu_7x7_s2(conv1_7x7_s2_bn)
        # pool1_3x3_s2 = self.vggface2.vggface2.pool1_3x3_s2(conv1_7x7_s2_bnxx)
        # conv2_1_1x1_reduce = self.vggface2.vggface2.conv2_1_1x1_reduce(pool1_3x3_s2)
        # conv2_1_1x1_reduce_bn = self.vggface2.vggface2.conv2_1_1x1_reduce_bn(conv2_1_1x1_reduce)
        # conv2_1_1x1_reduce_bnxx = self.vggface2.vggface2.conv2_1_1x1_reduce_relu(conv2_1_1x1_reduce_bn)
        # conv2_1_3x3 = self.vggface2.vggface2.conv2_1_3x3(conv2_1_1x1_reduce_bnxx)
        # conv2_1_3x3_bn = self.vggface2.vggface2.conv2_1_3x3_bn(conv2_1_3x3)
        # conv2_1_3x3_bnxx = self.vggface2.vggface2.conv2_1_3x3_relu(conv2_1_3x3_bn)
        # conv2_1_1x1_increase = self.vggface2.vggface2.conv2_1_1x1_increase(conv2_1_3x3_bnxx)
        # conv2_1_1x1_increase_bn = self.vggface2.vggface2.conv2_1_1x1_increase_bn(conv2_1_1x1_increase)
        # conv2_1_1x1_proj = self.vggface2.vggface2.conv2_1_1x1_proj(pool1_3x3_s2)
        # conv2_1_1x1_proj_bn = self.vggface2.vggface2.conv2_1_1x1_proj_bn(conv2_1_1x1_proj)
        # conv2_1 = torch.add(conv2_1_1x1_proj_bn, 1, conv2_1_1x1_increase_bn)
        # conv2_1x = self.vggface2.vggface2.conv2_1_relu(conv2_1)
        # conv2_2_1x1_reduce = self.vggface2.vggface2.conv2_2_1x1_reduce(conv2_1x)
        # conv2_2_1x1_reduce_bn = self.vggface2.vggface2.conv2_2_1x1_reduce_bn(conv2_2_1x1_reduce)
        # conv2_2_1x1_reduce_bnxx = self.vggface2.vggface2.conv2_2_1x1_reduce_relu(conv2_2_1x1_reduce_bn)
        # conv2_2_3x3 = self.vggface2.vggface2.conv2_2_3x3(conv2_2_1x1_reduce_bnxx)
        # conv2_2_3x3_bn = self.vggface2.vggface2.conv2_2_3x3_bn(conv2_2_3x3)
        # conv2_2_3x3_bnxx = self.vggface2.vggface2.conv2_2_3x3_relu(conv2_2_3x3_bn)
        # conv2_2_1x1_increase = self.vggface2.vggface2.conv2_2_1x1_increase(conv2_2_3x3_bnxx)
        # conv2_2_1x1_increase_bn = self.vggface2.vggface2.conv2_2_1x1_increase_bn(conv2_2_1x1_increase)
        # conv2_2 = torch.add(conv2_1x, 1, conv2_2_1x1_increase_bn)
        # conv2_2x = self.vggface2.vggface2.conv2_2_relu(conv2_2)
        # conv2_3_1x1_reduce = self.vggface2.vggface2.conv2_3_1x1_reduce(conv2_2x)
        # conv2_3_1x1_reduce_bn = self.vggface2.vggface2.conv2_3_1x1_reduce_bn(conv2_3_1x1_reduce)
        # conv2_3_1x1_reduce_bnxx = self.vggface2.vggface2.conv2_3_1x1_reduce_relu(conv2_3_1x1_reduce_bn)
        # conv2_3_3x3 = self.vggface2.vggface2.conv2_3_3x3(conv2_3_1x1_reduce_bnxx)
        # conv2_3_3x3_bn = self.vggface2.vggface2.conv2_3_3x3_bn(conv2_3_3x3)
        # conv2_3_3x3_bnxx = self.vggface2.vggface2.conv2_3_3x3_relu(conv2_3_3x3_bn)
        # conv2_3_1x1_increase = self.vggface2.vggface2.conv2_3_1x1_increase(conv2_3_3x3_bnxx)
        # conv2_3_1x1_increase_bn = self.vggface2.vggface2.conv2_3_1x1_increase_bn(conv2_3_1x1_increase)
        # conv2_3 = torch.add(conv2_2x, 1, conv2_3_1x1_increase_bn)
        # conv2_3x = self.vggface2.vggface2.conv2_3_relu(conv2_3)
        # conv3_1_1x1_reduce = self.vggface2.vggface2.conv3_1_1x1_reduce(conv2_3x)
        # conv3_1_1x1_reduce_bn = self.vggface2.vggface2.conv3_1_1x1_reduce_bn(conv3_1_1x1_reduce)
        # conv3_1_1x1_reduce_bnxx = self.vggface2.vggface2.conv3_1_1x1_reduce_relu(conv3_1_1x1_reduce_bn)
        # conv3_1_3x3 = self.vggface2.vggface2.conv3_1_3x3(conv3_1_1x1_reduce_bnxx)
        # conv3_1_3x3_bn = self.vggface2.vggface2.conv3_1_3x3_bn(conv3_1_3x3)
        # conv3_1_3x3_bnxx = self.vggface2.vggface2.conv3_1_3x3_relu(conv3_1_3x3_bn)
        # conv3_1_1x1_increase = self.vggface2.vggface2.conv3_1_1x1_increase(conv3_1_3x3_bnxx)
        # conv3_1_1x1_increase_bn = self.vggface2.vggface2.conv3_1_1x1_increase_bn(conv3_1_1x1_increase)
        # conv3_1_1x1_proj = self.vggface2.vggface2.conv3_1_1x1_proj(conv2_3x)
        # conv3_1_1x1_proj_bn = self.vggface2.vggface2.conv3_1_1x1_proj_bn(conv3_1_1x1_proj)
        # conv3_1 = torch.add(conv3_1_1x1_proj_bn, 1, conv3_1_1x1_increase_bn)
        # conv3_1x = self.vggface2.vggface2.conv3_1_relu(conv3_1)
        # conv3_2_1x1_reduce = self.vggface2.vggface2.conv3_2_1x1_reduce(conv3_1x)
        # conv3_2_1x1_reduce_bn = self.vggface2.vggface2.conv3_2_1x1_reduce_bn(conv3_2_1x1_reduce)
        # conv3_2_1x1_reduce_bnxx = self.vggface2.vggface2.conv3_2_1x1_reduce_relu(conv3_2_1x1_reduce_bn)
        # conv3_2_3x3 = self.vggface2.vggface2.conv3_2_3x3(conv3_2_1x1_reduce_bnxx)
        # conv3_2_3x3_bn = self.vggface2.vggface2.conv3_2_3x3_bn(conv3_2_3x3)
        # conv3_2_3x3_bnxx = self.vggface2.vggface2.conv3_2_3x3_relu(conv3_2_3x3_bn)
        # conv3_2_1x1_increase = self.vggface2.vggface2.conv3_2_1x1_increase(conv3_2_3x3_bnxx)
        # conv3_2_1x1_increase_bn = self.vggface2.vggface2.conv3_2_1x1_increase_bn(conv3_2_1x1_increase)
        # conv3_2 = torch.add(conv3_1x, 1, conv3_2_1x1_increase_bn)
        # conv3_2x = self.vggface2.vggface2.conv3_2_relu(conv3_2)
        # conv3_3_1x1_reduce = self.vggface2.vggface2.conv3_3_1x1_reduce(conv3_2x)
        # conv3_3_1x1_reduce_bn = self.vggface2.vggface2.conv3_3_1x1_reduce_bn(conv3_3_1x1_reduce)
        # conv3_3_1x1_reduce_bnxx = self.vggface2.vggface2.conv3_3_1x1_reduce_relu(conv3_3_1x1_reduce_bn)
        # conv3_3_3x3 = self.vggface2.vggface2.conv3_3_3x3(conv3_3_1x1_reduce_bnxx)
        # conv3_3_3x3_bn = self.vggface2.vggface2.conv3_3_3x3_bn(conv3_3_3x3)
        # conv3_3_3x3_bnxx = self.vggface2.vggface2.conv3_3_3x3_relu(conv3_3_3x3_bn)
        # conv3_3_1x1_increase = self.vggface2.vggface2.conv3_3_1x1_increase(conv3_3_3x3_bnxx)
        # conv3_3_1x1_increase_bn = self.vggface2.vggface2.conv3_3_1x1_increase_bn(conv3_3_1x1_increase)
        # conv3_3 = torch.add(conv3_2x, 1, conv3_3_1x1_increase_bn)
        # conv3_3x = self.vggface2.vggface2.conv3_3_relu(conv3_3)
        # conv3_4_1x1_reduce = self.vggface2.vggface2.conv3_4_1x1_reduce(conv3_3x)
        # conv3_4_1x1_reduce_bn = self.vggface2.vggface2.conv3_4_1x1_reduce_bn(conv3_4_1x1_reduce)
        # conv3_4_1x1_reduce_bnxx = self.vggface2.vggface2.conv3_4_1x1_reduce_relu(conv3_4_1x1_reduce_bn)
        # conv3_4_3x3 = self.vggface2.vggface2.conv3_4_3x3(conv3_4_1x1_reduce_bnxx)
        # conv3_4_3x3_bn = self.vggface2.vggface2.conv3_4_3x3_bn(conv3_4_3x3)
        # conv3_4_3x3_bnxx = self.vggface2.vggface2.conv3_4_3x3_relu(conv3_4_3x3_bn)
        # conv3_4_1x1_increase = self.vggface2.vggface2.conv3_4_1x1_increase(conv3_4_3x3_bnxx)
        # conv3_4_1x1_increase_bn = self.vggface2.vggface2.conv3_4_1x1_increase_bn(conv3_4_1x1_increase)
        # conv3_4 = torch.add(conv3_3x, 1, conv3_4_1x1_increase_bn)
        # conv3_4x = self.vggface2.vggface2.conv3_4_relu(conv3_4)
        # conv4_1_1x1_reduce = self.vggface2.vggface2.conv4_1_1x1_reduce(conv3_4x)
        # conv4_1_1x1_reduce_bn = self.vggface2.vggface2.conv4_1_1x1_reduce_bn(conv4_1_1x1_reduce)
        # conv4_1_1x1_reduce_bnxx = self.vggface2.vggface2.conv4_1_1x1_reduce_relu(conv4_1_1x1_reduce_bn)
        # conv4_1_3x3 = self.vggface2.vggface2.conv4_1_3x3(conv4_1_1x1_reduce_bnxx)
        # conv4_1_3x3_bn = self.vggface2.vggface2.conv4_1_3x3_bn(conv4_1_3x3)
        # conv4_1_3x3_bnxx = self.vggface2.vggface2.conv4_1_3x3_relu(conv4_1_3x3_bn)
        # conv4_1_1x1_increase = self.vggface2.vggface2.conv4_1_1x1_increase(conv4_1_3x3_bnxx)
        # conv4_1_1x1_increase_bn = self.vggface2.vggface2.conv4_1_1x1_increase_bn(conv4_1_1x1_increase)
        # conv4_1_1x1_proj = self.vggface2.vggface2.conv4_1_1x1_proj(conv3_4x)
        # conv4_1_1x1_proj_bn = self.vggface2.vggface2.conv4_1_1x1_proj_bn(conv4_1_1x1_proj)
        # conv4_1 = torch.add(conv4_1_1x1_proj_bn, 1, conv4_1_1x1_increase_bn)
        # conv4_1x = self.vggface2.vggface2.conv4_1_relu(conv4_1)
        # conv4_2_1x1_reduce = self.vggface2.vggface2.conv4_2_1x1_reduce(conv4_1x)
        # conv4_2_1x1_reduce_bn = self.vggface2.vggface2.conv4_2_1x1_reduce_bn(conv4_2_1x1_reduce)
        # conv4_2_1x1_reduce_bnxx = self.vggface2.vggface2.conv4_2_1x1_reduce_relu(conv4_2_1x1_reduce_bn)
        # conv4_2_3x3 = self.vggface2.vggface2.conv4_2_3x3(conv4_2_1x1_reduce_bnxx)
        # conv4_2_3x3_bn = self.vggface2.vggface2.conv4_2_3x3_bn(conv4_2_3x3)
        # conv4_2_3x3_bnxx = self.vggface2.vggface2.conv4_2_3x3_relu(conv4_2_3x3_bn)
        # conv4_2_1x1_increase = self.vggface2.vggface2.conv4_2_1x1_increase(conv4_2_3x3_bnxx)
        # conv4_2_1x1_increase_bn = self.vggface2.vggface2.conv4_2_1x1_increase_bn(conv4_2_1x1_increase)
        # conv4_2 = torch.add(conv4_1x, 1, conv4_2_1x1_increase_bn)
        # conv4_2x = self.vggface2.vggface2.conv4_2_relu(conv4_2)
        # conv4_3_1x1_reduce = self.vggface2.vggface2.conv4_3_1x1_reduce(conv4_2x)
        # conv4_3_1x1_reduce_bn = self.vggface2.vggface2.conv4_3_1x1_reduce_bn(conv4_3_1x1_reduce)
        # conv4_3_1x1_reduce_bnxx = self.vggface2.vggface2.conv4_3_1x1_reduce_relu(conv4_3_1x1_reduce_bn)
        # conv4_3_3x3 = self.vggface2.vggface2.conv4_3_3x3(conv4_3_1x1_reduce_bnxx)
        # conv4_3_3x3_bn = self.vggface2.vggface2.conv4_3_3x3_bn(conv4_3_3x3)
        # conv4_3_3x3_bnxx = self.vggface2.vggface2.conv4_3_3x3_relu(conv4_3_3x3_bn)
        # conv4_3_1x1_increase = self.vggface2.vggface2.conv4_3_1x1_increase(conv4_3_3x3_bnxx)
        # conv4_3_1x1_increase_bn = self.vggface2.vggface2.conv4_3_1x1_increase_bn(conv4_3_1x1_increase)
        # conv4_3 = torch.add(conv4_2x, 1, conv4_3_1x1_increase_bn)
        # conv4_3x = self.vggface2.vggface2.conv4_3_relu(conv4_3)
        # conv4_4_1x1_reduce = self.vggface2.vggface2.conv4_4_1x1_reduce(conv4_3x)
        # conv4_4_1x1_reduce_bn = self.vggface2.vggface2.conv4_4_1x1_reduce_bn(conv4_4_1x1_reduce)
        # conv4_4_1x1_reduce_bnxx = self.vggface2.vggface2.conv4_4_1x1_reduce_relu(conv4_4_1x1_reduce_bn)
        # conv4_4_3x3 = self.vggface2.vggface2.conv4_4_3x3(conv4_4_1x1_reduce_bnxx)
        # conv4_4_3x3_bn = self.vggface2.vggface2.conv4_4_3x3_bn(conv4_4_3x3)
        # conv4_4_3x3_bnxx = self.vggface2.vggface2.conv4_4_3x3_relu(conv4_4_3x3_bn)
        # conv4_4_1x1_increase = self.vggface2.vggface2.conv4_4_1x1_increase(conv4_4_3x3_bnxx)
        # conv4_4_1x1_increase_bn = self.vggface2.vggface2.conv4_4_1x1_increase_bn(conv4_4_1x1_increase)
        # conv4_4 = torch.add(conv4_3x, 1, conv4_4_1x1_increase_bn)
        # conv4_4x = self.vggface2.vggface2.conv4_4_relu(conv4_4)
        # conv4_5_1x1_reduce = self.vggface2.vggface2.conv4_5_1x1_reduce(conv4_4x)
        # conv4_5_1x1_reduce_bn = self.vggface2.vggface2.conv4_5_1x1_reduce_bn(conv4_5_1x1_reduce)
        # conv4_5_1x1_reduce_bnxx = self.vggface2.vggface2.conv4_5_1x1_reduce_relu(conv4_5_1x1_reduce_bn)
        # conv4_5_3x3 = self.vggface2.vggface2.conv4_5_3x3(conv4_5_1x1_reduce_bnxx)
        # conv4_5_3x3_bn = self.vggface2.vggface2.conv4_5_3x3_bn(conv4_5_3x3)
        # conv4_5_3x3_bnxx = self.vggface2.vggface2.conv4_5_3x3_relu(conv4_5_3x3_bn)
        # conv4_5_1x1_increase = self.vggface2.vggface2.conv4_5_1x1_increase(conv4_5_3x3_bnxx)
        # conv4_5_1x1_increase_bn = self.vggface2.vggface2.conv4_5_1x1_increase_bn(conv4_5_1x1_increase)
        # conv4_5 = torch.add(conv4_4x, 1, conv4_5_1x1_increase_bn)
        # conv4_5x = self.vggface2.vggface2.conv4_5_relu(conv4_5)
        # conv4_6_1x1_reduce = self.vggface2.vggface2.conv4_6_1x1_reduce(conv4_5x)
        # conv4_6_1x1_reduce_bn = self.vggface2.vggface2.conv4_6_1x1_reduce_bn(conv4_6_1x1_reduce)
        # conv4_6_1x1_reduce_bnxx = self.vggface2.vggface2.conv4_6_1x1_reduce_relu(conv4_6_1x1_reduce_bn)
        # conv4_6_3x3 = self.vggface2.vggface2.conv4_6_3x3(conv4_6_1x1_reduce_bnxx)
        # conv4_6_3x3_bn = self.vggface2.vggface2.conv4_6_3x3_bn(conv4_6_3x3)
        # conv4_6_3x3_bnxx = self.vggface2.vggface2.conv4_6_3x3_relu(conv4_6_3x3_bn)
        # conv4_6_1x1_increase = self.vggface2.vggface2.conv4_6_1x1_increase(conv4_6_3x3_bnxx)
        # conv4_6_1x1_increase_bn = self.vggface2.vggface2.conv4_6_1x1_increase_bn(conv4_6_1x1_increase)
        # conv4_6 = torch.add(conv4_5x, 1, conv4_6_1x1_increase_bn)
        # conv4_6x = self.vggface2.vggface2.conv4_6_relu(conv4_6)
        #
        # conv5_1_1x1_reduce = self.vggface2.vggface2.conv5_1_1x1_reduce(conv4_6x)
        # conv5_1_1x1_reduce_bn = self.vggface2.vggface2.conv5_1_1x1_reduce_bn(conv5_1_1x1_reduce)
        # conv5_1_1x1_reduce_bnxx = self.vggface2.vggface2.conv5_1_1x1_reduce_relu(conv5_1_1x1_reduce_bn)
        #
        # ### replace
        # conv5_1_3x3 = self.vggface2.vggface2.conv5_1_3x3(conv5_1_1x1_reduce_bnxx)
        # # conv5_1_3x3 = self.mhsa_c5_1(conv5_1_1x1_reduce_bnxx)
        # ###
        # conv5_1_3x3_bn = self.vggface2.vggface2.conv5_1_3x3_bn(conv5_1_3x3)
        # conv5_1_3x3_bnxx = self.vggface2.vggface2.conv5_1_3x3_relu(conv5_1_3x3_bn)
        #
        # conv5_1_1x1_increase = self.vggface2.vggface2.conv5_1_1x1_increase(conv5_1_3x3_bnxx)
        # conv5_1_1x1_increase_bn = self.vggface2.vggface2.conv5_1_1x1_increase_bn(conv5_1_1x1_increase)
        # conv5_1_1x1_proj = self.vggface2.vggface2.conv5_1_1x1_proj(conv4_6x)
        # conv5_1_1x1_proj_bn = self.vggface2.vggface2.conv5_1_1x1_proj_bn(conv5_1_1x1_proj)
        # conv5_1 = torch.add(conv5_1_1x1_proj_bn, 1, conv5_1_1x1_increase_bn)
        # conv5_1x = self.vggface2.vggface2.conv5_1_relu(conv5_1)
        # conv5_2_1x1_reduce = self.vggface2.vggface2.conv5_2_1x1_reduce(conv5_1x)
        # conv5_2_1x1_reduce_bn = self.vggface2.vggface2.conv5_2_1x1_reduce_bn(conv5_2_1x1_reduce)
        # conv5_2_1x1_reduce_bnxx = self.vggface2.vggface2.conv5_2_1x1_reduce_relu(conv5_2_1x1_reduce_bn)
        #
        # ### replace
        # conv5_2_3x3 = self.vggface2.vggface2.conv5_2_3x3(conv5_2_1x1_reduce_bnxx)
        # # conv5_2_3x3 = self.mhsa_c5_2(conv5_2_1x1_reduce_bnxx)
        # ###
        # conv5_2_3x3_bn = self.vggface2.vggface2.conv5_2_3x3_bn(conv5_2_3x3)
        # conv5_2_3x3_bnxx = self.vggface2.vggface2.conv5_2_3x3_relu(conv5_2_3x3_bn)
        #
        # conv5_2_1x1_increase = self.vggface2.vggface2.conv5_2_1x1_increase(conv5_2_3x3_bnxx)
        # conv5_2_1x1_increase_bn = self.vggface2.vggface2.conv5_2_1x1_increase_bn(conv5_2_1x1_increase)
        # conv5_2 = torch.add(conv5_1x, 1, conv5_2_1x1_increase_bn)
        # conv5_2x = self.vggface2.vggface2.conv5_2_relu(conv5_2)
        # conv5_3_1x1_reduce = self.vggface2.vggface2.conv5_3_1x1_reduce(conv5_2x)
        # conv5_3_1x1_reduce_bn = self.vggface2.vggface2.conv5_3_1x1_reduce_bn(conv5_3_1x1_reduce)
        # conv5_3_1x1_reduce_bnxx = self.vggface2.vggface2.conv5_3_1x1_reduce_relu(conv5_3_1x1_reduce_bn)
        #
        # ### replace
        # conv5_3_3x3 = self.vggface2.vggface2.conv5_3_3x3(conv5_3_1x1_reduce_bnxx)
        # # conv5_3_3x3 = self.mhsa_c5_3(conv5_3_1x1_reduce_bnxx)
        # ###
        # conv5_3_3x3_bn = self.vggface2.vggface2.conv5_3_3x3_bn(conv5_3_3x3)
        # conv5_3_3x3_bnxx = self.vggface2.vggface2.conv5_3_3x3_relu(conv5_3_3x3_bn)
        #
        #
        # conv5_3_1x1_increase = self.vggface2.vggface2.conv5_3_1x1_increase(conv5_3_3x3_bnxx)
        # conv5_3_1x1_increase_bn = self.vggface2.vggface2.conv5_3_1x1_increase_bn(conv5_3_1x1_increase)
        # conv5_3 = torch.add(conv5_2x, 1, conv5_3_1x1_increase_bn)
        # conv5_3x = self.vggface2.vggface2.conv5_3_relu(conv5_3)
        # pool5_7x7_s1 = self.vggface2.vggface2.pool5_7x7_s1(conv5_3x)
        #
        # classifier_flatten = pool5_7x7_s1.view(pool5_7x7_s1.size(0), -1)
        # # classifier_flatten = torch.flatten(pool5_7x7_s1)
        # classifier = self.vggface2.vggface2.classifier(classifier_flatten)
        #
        # return classifier


if __name__ == "__main__":
    from torchvision import transforms
    from PIL import Image
    import numpy as np

    device = torch.device("cuda" if torch.cuda.is_available() else "cpu")

    model = VGGFace2BotS1().to(device)
    print("Model archticture: ", model)

    x = np.random.rand(224, 224, 3)
    x = Image.fromarray(x.astype(np.uint8))

    model.eval()
    with torch.no_grad():
        out = model(transforms.ToTensor()(x).unsqueeze_(0))
        print(out)
